# üîç –û—Ç–ª–∞–¥–∫–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞:
- Backend (server/routes/profile-requests.js)
- Frontend (client/src/components/ProfileEditView.tsx)
- API Client (client/src/lib/api.ts)

---

## üìã –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

### –®–∞–≥ 1: –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

```bash
# –ö–æ–º–º–∏—Ç
git add .
git commit -m "Debug: –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π"
git push origin main

# Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç
```

### –®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram**
2. **–ù–∞–∂–º–∏—Ç–µ F12 (–∏–ª–∏ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π ‚Üí "Inspect")**
3. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É "Console"**
4. **–û—á–∏—Å—Ç–∏—Ç–µ –∫–æ–Ω—Å–æ–ª—å (–∫–Ω–æ–ø–∫–∞ üö´ –∏–ª–∏ Ctrl+L)**

### –®–∞–≥ 3: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

1. **–ü—Ä–æ—Ñ–∏–ª—å ‚Üí –ö–Ω–æ–ø–∫–∞ ‚úèÔ∏è**
2. **–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è**
3. **–ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é"**
4. **–°–ú–û–¢–†–ò–¢–ï –í –ö–û–ù–°–û–õ–¨!**

### –®–∞–≥ 4: –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ª–æ–≥–∏ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:

```
=== Profile Edit Submit Started ===
User: {id: 1, telegram_id: 123456, ...}
Current name: "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"
Requested name: "–ò–≤–∞–Ω Pro"
...

=== API Request ===
Endpoint: /profile-requests
Method: POST
Has initData: true
Request body: {"currentName":"–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤","requestedName":"–ò–≤–∞–Ω Pro",...}

Response status: 201
Response data: {id: 1, user_id: 1, ...}

Request created successfully: {id: 1, ...}
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Render Dashboard**
2. **–í–∞—à backend —Å–µ—Ä–≤–∏—Å ‚Üí Logs**
3. **–ù–∞–π–¥–∏—Ç–µ –ª–æ–≥–∏ –≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞**

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

```
=== Profile Request Creation Started ===
Request body: { currentName: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤', requestedName: '–ò–≤–∞–Ω Pro', ... }
Telegram user: 123456
User from middleware: 1
Using req.user.id: 1
Creating profile request with: { userId: 1, currentName: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤', ... }
Profile request created successfully: 1
```

---

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –æ—à–∏–±–∫–∞ "Network error"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API_URL

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `VITE_API_URL` –≤ Render
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ backend –¥–æ—Å—Ç—É–ø–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–µ—Ç CORS –æ—à–∏–±–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –í –∫–æ–Ω—Å–æ–ª–∏ "Has initData: false"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–µ –≤ Telegram

**–†–µ—à–µ–Ω–∏–µ:**
1. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ —á–µ—Ä–µ–∑ Telegram Mini App
2. –ù–µ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Backend –ª–æ–≥–∏: "User not found for telegram_id"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –ø–æ–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –ø—Ä–æ—Ñ–∏–ª—å
3. –ü–æ—Ç–æ–º –ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Backend –ª–æ–≥–∏: "No changes provided"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–∞ backend –Ω–µ –ø—Ä–∏—à–ª–∏ –¥–∞–Ω–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `requestedName` –Ω–µ –ø—É—Å—Ç–æ–π
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∏–º—è –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ
3. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ frontend —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

### –ü—Ä–æ–±–ª–µ–º–∞ 5: Response status: 403

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ middleware –≤ backend

### –ü—Ä–æ–±–ª–µ–º–∞ 6: Response status: 500

**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ë–î)

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–º–æ—Ç—Ä–∏—Ç–µ backend –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `users` –µ—Å—Ç—å –ø–æ–ª–µ `name`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `profile_change_requests` —Å–æ–∑–¥–∞–Ω–∞

---

## üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø–æ–ª–µ `name` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:

```sql
-- –í Render Dashboard ‚Üí PostgreSQL ‚Üí Connect
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'users'
ORDER BY ordinal_position;
```

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
column_name       | data_type         | is_nullable
------------------|-------------------|------------
id                | integer           | NO
telegram_id       | bigint            | NO
username          | varchar(255)      | YES
first_name        | varchar(255)      | YES
last_name         | varchar(255)      | YES
name              | varchar(255)      | YES  ‚Üê –î–û–õ–ñ–ù–û –ë–´–¢–¨!
photo_url         | text              | YES
is_admin          | boolean           | YES
is_blocked        | boolean           | YES
created_at        | timestamp         | YES
last_active       | timestamp         | YES
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã profile_change_requests:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
SELECT * FROM profile_change_requests LIMIT 1;
```

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "relation does not exist":
```sql
-- –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤—Ä—É—á–Ω—É—é
CREATE TABLE IF NOT EXISTS profile_change_requests (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  current_name VARCHAR(255) NOT NULL,
  current_avatar_url TEXT,
  requested_name VARCHAR(255),
  requested_avatar_url TEXT,
  status VARCHAR(20) NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected')),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –∏–º–µ–Ω–∞
SELECT id, telegram_id, first_name, last_name, name, is_blocked
FROM users
ORDER BY id DESC
LIMIT 10;
```

---

## üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã:

1. **–ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** —Å –ø–æ–ª–Ω—ã–º –ª–æ–≥–æ–º
2. **Backend –ª–æ–≥–∏** –≤ Render –≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
3. **–§–æ—Ä–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è** (—á—Ç–æ –≤–≤–æ–¥–∏—Ç–µ)
4. **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏**

---

## üö® –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ endpoint –Ω–∞–ø—Ä—è–º—É—é

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Postman –∏–ª–∏ curl:

```bash
# –ü–æ–ª—É—á–∏—Ç—å –≤–∞—à initData –∏–∑ Telegram
# –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
console.log(window.Telegram.WebApp.initData);

# –ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å:
curl -X POST https://your-backend.onrender.com/api/profile-requests \
  -H "Content-Type: application/json" \
  -H "X-Telegram-Init-Data: –≤–∞—à_init_data" \
  -d '{
    "currentName": "Test User",
    "requestedName": "New Name"
  }'
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ SQL

```sql
-- –í—Å—Ç–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î
INSERT INTO profile_change_requests 
  (user_id, current_name, requested_name, status)
VALUES 
  (1, 'Test User', 'New Name', 'pending');

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—Ç–∞–≤–∏–ª–æ—Å—å
SELECT * FROM profile_change_requests 
WHERE user_id = 1
ORDER BY created_at DESC;
```

### –¢–µ—Å—Ç 3: –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å checkUserBlocked

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ middleware, –≤—Ä–µ–º–µ–Ω–Ω–æ —É–±–µ—Ä–∏—Ç–µ –µ–≥–æ:

```javascript
// –í profile-requests.js
// –í–†–ï–ú–ï–ù–ù–û –¥–ª—è —Ç–µ—Å—Ç–∞
router.post('/', authenticateTelegram, /* checkUserBlocked, */ async (req, res) => {
  // ...
});
```

---

## üìû –ß—Ç–æ –º–Ω–µ —Å–æ–æ–±—â–∏—Ç—å

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤—å—Ç–µ:

1. **–õ–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞** (—Ç–µ–∫—Å—Ç–æ–º –∏–ª–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç)
2. **–õ–æ–≥–∏ –∏–∑ Render backend** (–≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞)
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç SQL –∑–∞–ø—Ä–æ—Å–æ–≤** (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü)
4. **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ** (–æ–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –≤–∏–¥–µ–æ)

---

## ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

1. ‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤–∏–¥–Ω—ã –≤—Å–µ —ç—Ç–∞–ø—ã
2. ‚úÖ API –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –∫–æ–¥–æ–º 201
3. ‚úÖ Backend —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î
4. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç toast "–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω"
5. ‚úÖ –§–æ—Ä–º–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
6. ‚úÖ –í –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∑–∞—è–≤–∫–∞

---

**–¢–µ–ø–µ—Ä—å –∑–∞–¥–µ–ø–ª–æ–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –ø—Ä–∏—à–ª–∏—Ç–µ –ª–æ–≥–∏! üîç**

