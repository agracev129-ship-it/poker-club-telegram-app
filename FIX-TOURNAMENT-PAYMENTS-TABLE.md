# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏: —Ç–∞–±–ª–∏—Ü–∞ tournament_payments –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

**–û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
```
Database query error: error: relation "tournament_payments" does not exist
Error code: 42P01 (undefined_table)
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–¢–∞–±–ª–∏—Ü–∞ `tournament_payments` –Ω–µ —Å–æ–∑–¥–∞–Ω–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –Ω–∞ Render.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Render Dashboard (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Render Dashboard:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://dashboard.render.com
   - –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç

2. **–ù–∞–π–¥–∏—Ç–µ –≤–∞—à—É –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL:**
   - –í —Å–ø–∏—Å–∫–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞–π–¥–∏—Ç–µ –≤–∞—à PostgreSQL —Å–µ—Ä–≤–∏—Å
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ

3. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É "Connect":**
   - –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –Ω–∞–∂–º–∏—Ç–µ "Connect"
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ "Internal Database URL" –∏–ª–∏ "External Database URL"

4. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π PostgreSQL –∫–ª–∏–µ–Ω—Ç (pgAdmin, DBeaver, –∏–ª–∏ –æ–Ω–ª–∞–π–Ω-—Ä–µ–¥–∞–∫—Ç–æ—Ä)
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π SQL —Ä–µ–¥–∞–∫—Ç–æ—Ä Render (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)

5. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `server/database/create-tournament-payments.sql`
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å SQL –∫–æ–¥
   - –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL —Ä–µ–¥–∞–∫—Ç–æ—Ä
   - –ù–∞–∂–º–∏—Ç–µ "Execute" –∏–ª–∏ "Run"

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ psql (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ psql** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω):
   ```bash
   # Windows (—á–µ—Ä–µ–∑ Chocolatey)
   choco install postgresql
   
   # Mac
   brew install postgresql
   
   # Linux
   sudo apt-get install postgresql-client
   ```

2. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**
   ```bash
   psql "postgresql://user:password@host:port/database"
   ```
   
   –ì–¥–µ:
   - `user` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Render
   - `password` - –ø–∞—Ä–æ–ª—å –∏–∑ Render
   - `host` - —Ö–æ—Å—Ç –∏–∑ Render (–Ω–∞–ø—Ä–∏–º–µ—Ä, `dpg-xxxxx-a.oregon-postgres.render.com`)
   - `port` - –ø–æ—Ä—Ç (–æ–±—ã—á–Ω–æ 5432)
   - `database` - –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

3. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç:**
   ```bash
   \i server/database/create-tournament-payments.sql
   ```
   
   –ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ psql.

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ –æ–Ω–ª–∞–π–Ω SQL —Ä–µ–¥–∞–∫—Ç–æ—Ä

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–Ω–ª–∞–π–Ω SQL —Ä–µ–¥–∞–∫—Ç–æ—Ä:**
   - https://www.elephantsql.com/ (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π)
   - https://adminer.org/ (–º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ)
   - –ò–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π PostgreSQL –∫–ª–∏–µ–Ω—Ç

2. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Render:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ Render Dashboard

3. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç:**
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `server/database/create-tournament-payments.sql`
   - –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL —Ä–µ–¥–∞–∫—Ç–æ—Ä
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ

---

## üìã SQL —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü

### –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–±—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)

**–§–∞–π–ª:** `server/database/create-tournament-payments.sql`

–°–æ–∑–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü—É `tournament_payments` (–∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É).

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã tournament_payments
CREATE TABLE IF NOT EXISTS tournament_payments (
  id SERIAL PRIMARY KEY,
  game_id INTEGER NOT NULL REFERENCES games(id) ON DELETE CASCADE,
  user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  registration_id INTEGER REFERENCES game_registrations(id) ON DELETE CASCADE,
  amount DECIMAL(10, 2) NOT NULL,
  payment_method VARCHAR(50) NOT NULL,
  status VARCHAR(20) DEFAULT 'pending',
  confirmed_by INTEGER REFERENCES users(id),
  confirmed_at TIMESTAMP,
  refunded_at TIMESTAMP,
  refund_reason TEXT,
  notes TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT tp_status_check CHECK (status IN ('pending', 'confirmed', 'refunded')),
  CONSTRAINT tp_amount_positive CHECK (amount > 0)
);

-- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
CREATE INDEX IF NOT EXISTS idx_tp_game_user ON tournament_payments(game_id, user_id);
CREATE INDEX IF NOT EXISTS idx_tp_status ON tournament_payments(status);
CREATE INDEX IF NOT EXISTS idx_tp_registration ON tournament_payments(registration_id);
CREATE INDEX IF NOT EXISTS idx_tp_created_at ON tournament_payments(created_at);
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–§–∞–π–ª:** `server/database/create-all-tournament-tables.sql`

–°–æ–∑–¥–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- ‚úÖ `tournament_payments` - –ø–ª–∞—Ç–µ–∂–∏
- ‚úÖ `tournament_actions_log` - –ª–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- ‚úÖ `tournament_point_structure` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—á–∫–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç**, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ä–∞–∑—É –∏ –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º –≤ –±—É–¥—É—â–µ–º.

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞:**
   ```sql
   SELECT table_name 
   FROM information_schema.tables 
   WHERE table_schema = 'public' 
   AND table_name = 'tournament_payments';
   ```
   
   –î–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å—Å—è —Å—Ç—Ä–æ–∫–∞ —Å `tournament_payments`.

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã:**
   ```sql
   \d tournament_payments
   ```
   
   –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Å–µ –∫–æ–ª–æ–Ω–∫–∏: `id`, `game_id`, `user_id`, `amount`, `payment_method`, –∏ —Ç.–¥.

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –Ω–∞ Render:**
   - –í Render Dashboard –Ω–∞–π–¥–∏—Ç–µ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
   - –ù–∞–∂–º–∏—Ç–µ "Manual Deploy" ‚Üí "Deploy latest commit"
   - –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–∏—Ç–µ, –ø–æ–∫–∞ —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ Render
   - –û—à–∏–±–∫–∞ `relation "tournament_payments" does not exist` –±–æ–ª—å—à–µ –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–ª—è—Ç—å—Å—è

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

–ï—Å–ª–∏ –≤—ã –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–ª–∏ –¥—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–æ–≤, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–∞–∫–∂–µ:

1. **`tournament_actions_log`** - –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
2. **`tournament_point_structure`** - –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—á–∫–æ–≤

–≠—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ —Ñ–∞–π–ª–µ:
- `server/database/schema-tournament-lifecycle.sql`

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- ‚úÖ –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `CREATE TABLE IF NOT EXISTS`, –ø–æ—ç—Ç–æ–º—É –µ–≥–æ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ
- ‚úÖ –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å `IF NOT EXISTS`, –ø–æ—ç—Ç–æ–º—É –∏—Ö —Ç–æ–∂–µ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–≥—Ä—ã (`ON DELETE CASCADE`)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`ON DELETE CASCADE`)

---

## üéØ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã:

1. ‚úÖ –û—à–∏–±–∫–∞ `relation "tournament_payments" does not exist` –∏—Å—á–µ–∑–Ω–µ—Ç
2. ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. ‚úÖ –î–∞–Ω–Ω—ã–µ –æ –ø–ª–∞—Ç–µ–∂–∞—Ö –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ
4. ‚úÖ –ò–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ —Å–ø–∏—Å–∫–µ "–û–ø–ª–∞—Ç–∏–ª–∏"

---

## üÜò –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ credentials –∏–∑ Render
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `DATABASE_URL` –Ω–∞ Render

4. **–°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:**
   - –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Render
   - –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ç–∏–∫–µ—Ç –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É Render

---

**–ì–æ—Ç–æ–≤–æ! –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –≤—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å! üéâ**

