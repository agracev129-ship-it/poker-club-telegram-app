import { useState, useRef, useEffect } from 'react';

interface TermsAndConditionsProps {
  onAccept: () => void;
}

export function TermsAndConditions({ onAccept }: TermsAndConditionsProps) {
  const [isScrolledToBottom, setIsScrolledToBottom] = useState(false);
  const scrollContainerRef = useRef<HTMLDivElement>(null);

  const handleScroll = () => {
    if (scrollContainerRef.current) {
      const { scrollTop, scrollHeight, clientHeight } = scrollContainerRef.current;
      // Проверяем, долистал ли пользователь до конца (с небольшим порогом в 10px)
      const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10;
      setIsScrolledToBottom(isAtBottom);
    }
  };

  useEffect(() => {
    const container = scrollContainerRef.current;
    if (container) {
      container.addEventListener('scroll', handleScroll);
      // Проверяем сразу, если контент короткий и не требует прокрутки
      handleScroll();
      return () => container.removeEventListener('scroll', handleScroll);
    }
  }, []);

  return (
    <div className="fixed inset-0 z-50 bg-black flex flex-col">
      {/* Header */}
      <div className="px-6 pt-8 pb-4 border-b border-gray-800">
        <h1 className="text-2xl text-white mb-2">Пользовательское соглашение</h1>
        <p className="text-sm text-gray-400">
          Пожалуйста, прочитайте соглашение до конца
        </p>
      </div>

      {/* Scrollable Content */}
      <div
        ref={scrollContainerRef}
        className="flex-1 overflow-y-auto px-6 py-6"
      >
        <div className="space-y-6 text-gray-300 text-sm leading-relaxed">
          <section>
            <h2 className="text-lg text-white mb-3">1. Общие положения</h2>
            <p className="mb-3">
              Настоящее Пользовательское соглашение (далее — «Соглашение») регулирует отношения между 
              администрацией игрового клуба (далее — «Клуб») и пользователями мобильного приложения 
              (далее — «Приложение»).
            </p>
            <p className="mb-3">
              Использование Приложения означает безоговорочное согласие пользователя с настоящим 
              Соглашением и указанными в нем условиями. В случае несогласия с этими условиями 
              пользователь должен воздержаться от использования Приложения.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">2. Регистрация и учетная запись</h2>
            <p className="mb-3">
              Для использования функционала Приложения может потребоваться регистрация. Пользователь 
              обязуется предоставить достоверную и полную информацию о себе и поддерживать эту 
              информацию в актуальном состоянии.
            </p>
            <p className="mb-3">
              Пользователь несет ответственность за сохранность своих учетных данных и все действия, 
              совершенные с использованием его учетной записи.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">3. Регистрация на игры и турниры</h2>
            <p className="mb-3">
              Регистрация на игры и турниры через Приложение является обязательством пользователя 
              принять участие в выбранном мероприятии. В случае невозможности участия пользователь 
              обязуется отменить регистрацию заблаговременно.
            </p>
            <p className="mb-3">
              Клуб оставляет за собой право отменить регистрацию пользователя в случае нарушения 
              правил или неоднократной неявки на зарегистрированные мероприятия без уведомления.
            </p>
            <p className="mb-3">
              Некоторые мероприятия могут требовать внесения бай-ина или регистрационного взноса. 
              Условия возврата средств устанавливаются индивидуально для каждого мероприятия.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">4. Правила поведения</h2>
            <p className="mb-3">
              Пользователь обязуется соблюдать правила игрового клуба, проявлять уважение к другим 
              участникам и персоналу, следовать указаниям администрации.
            </p>
            <p className="mb-3">
              Запрещается использование Приложения для распространения незаконной, оскорбительной, 
              клеветнической информации или материалов, нарушающих права третьих лиц.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">5. Персональные данные и конфиденциальность</h2>
            <p className="mb-3">
              Клуб обязуется обеспечивать конфиденциальность персональных данных пользователей в 
              соответствии с действующим законодательством о защите персональных данных.
            </p>
            <p className="mb-3">
              Персональные данные пользователей используются исключительно для обеспечения 
              функционирования Приложения, организации мероприятий и улучшения качества услуг.
            </p>
            <p className="mb-3">
              Пользователь имеет право запросить удаление своих персональных данных, обратившись к 
              администрации Клуба.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">6. Рейтинговая система</h2>
            <p className="mb-3">
              Рейтинг пользователей формируется автоматически на основе результатов участия в 
              мероприятиях. Клуб оставляет за собой право корректировать рейтинг в случае выявления 
              нарушений или технических ошибок.
            </p>
            <p className="mb-3">
              Попытки искусственного повышения рейтинга или манипулирования системой запрещены и 
              могут привести к блокировке учетной записи.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">7. Финансовые операции</h2>
            <p className="mb-3">
              Все финансовые операции, связанные с участием в мероприятиях, осуществляются в 
              соответствии с установленными правилами Клуба.
            </p>
            <p className="mb-3">
              Пользователь обязуется своевременно производить оплату участия в платных мероприятиях. 
              Условия и порядок возврата средств определяются индивидуально для каждого мероприятия.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">8. Ограничение ответственности</h2>
            <p className="mb-3">
              Приложение предоставляется «как есть». Клуб не несет ответственности за временную 
              недоступность Приложения, потерю данных или любые убытки, возникшие в результате 
              использования Приложения.
            </p>
            <p className="mb-3">
              Клуб не несет ответственности за действия пользователей и взаимодействие между 
              пользователями вне рамок официальных мероприятий.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">9. Изменение условий</h2>
            <p className="mb-3">
              Клуб оставляет за собой право в любое время изменять условия настоящего Соглашения. 
              Новая редакция Соглашения вступает в силу с момента ее размещения в Приложении.
            </p>
            <p className="mb-3">
              Продолжение использования Приложения после внесения изменений означает согласие 
              пользователя с новой редакцией Соглашения.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">10. Блокировка и удаление учетной записи</h2>
            <p className="mb-3">
              Клуб оставляет за собой право заблокировать или удалить учетную запись пользователя 
              без предварительного уведомления в случае нарушения условий настоящего Соглашения.
            </p>
            <p className="mb-3">
              Пользователь может самостоятельно удалить свою учетную запись, обратившись к 
              администрации Клуба.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">11. Интеллектуальная собственность</h2>
            <p className="mb-3">
              Все материалы, содержащиеся в Приложении, включая текст, графику, логотипы, являются 
              интеллектуальной собственностью Клуба и защищены законодательством об авторском праве.
            </p>
            <p className="mb-3">
              Использование материалов Приложения без письменного разрешения Клуба запрещено.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">12. Возрастные ограничения</h2>
            <p className="mb-3">
              Приложение предназначено для лиц, достигших 18 лет. Использование Приложения лицами 
              младше указанного возраста запрещено.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">13. Контактная информация</h2>
            <p className="mb-3">
              По всем вопросам, связанным с использованием Приложения и настоящим Соглашением, 
              пользователи могут обращаться к администрации Клуба через раздел «Профиль» в Приложении.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">14. Заключительные положения</h2>
            <p className="mb-3">
              Настоящее Соглашение регулируется и толкуется в соответствии с законодательством 
              Российской Федерации.
            </p>
            <p className="mb-3">
              Все споры, возникающие из настоящего Соглашения или в связи с ним, разрешаются путем 
              переговоров. В случае невозможности достижения согласия спор передается на рассмотрение 
              в суд по месту нахождения Клуба.
            </p>
            <p className="mb-3">
              Принимая настоящее Соглашение, пользователь подтверждает, что ознакомился со всеми его 
              условиями и обязуется их соблюдать.
            </p>
          </section>

          <div className="h-4"></div>
        </div>
      </div>

      {/* Footer with Accept Button */}
      <div className="px-6 py-4 border-t border-gray-800 bg-black">
        <button
          onClick={onAccept}
          disabled={!isScrolledToBottom}
          className={`w-full py-3.5 rounded-xl transition-all flex items-center justify-center ${
            isScrolledToBottom
              ? 'bg-gradient-to-b from-red-600 to-red-800 hover:from-red-700 hover:to-red-900 text-white cursor-pointer'
              : 'bg-gray-800 text-gray-500 cursor-not-allowed'
          }`}
        >
          Принять
        </button>
      </div>
    </div>
  );
}

