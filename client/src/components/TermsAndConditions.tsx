import { useState, useRef, useEffect } from 'react';
import { getIOSPaddingTop } from '../lib/platform';

// Версия соглашения - при изменении все пользователи должны заново принять соглашение
export const TERMS_VERSION = '2025-11-24';

interface TermsAndConditionsProps {
  onAccept: () => void;
}

export function TermsAndConditions({ onAccept }: TermsAndConditionsProps) {
  const [isScrolledToBottom, setIsScrolledToBottom] = useState(false);
  const scrollContainerRef = useRef<HTMLDivElement>(null);

  const handleScroll = () => {
    if (scrollContainerRef.current) {
      const { scrollTop, scrollHeight, clientHeight } = scrollContainerRef.current;
      // Проверяем, долистал ли пользователь до конца (с небольшим порогом в 10px)
      const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10;
      setIsScrolledToBottom(isAtBottom);
    }
  };

  useEffect(() => {
    const container = scrollContainerRef.current;
    if (container) {
      container.addEventListener('scroll', handleScroll);
      // Проверяем сразу, если контент короткий и не требует прокрутки
      handleScroll();
      return () => container.removeEventListener('scroll', handleScroll);
    }
  }, []);

  return (
    <div className={`fixed inset-0 z-50 bg-black flex flex-col ${getIOSPaddingTop()}`}>
      {/* Header */}
      <div className="px-6 pt-8 pb-4 border-b border-gray-800">
        <h1 className="text-2xl text-white mb-2">Пользовательское соглашение</h1>
        <p className="text-sm text-gray-400">
          Пожалуйста, прочитайте соглашение до конца
        </p>
        <p className="text-xs text-gray-500 mt-1">
          Редакция от 24 ноября 2025 г.
        </p>
      </div>

      {/* Scrollable Content */}
      <div
        ref={scrollContainerRef}
        className="flex-1 overflow-y-auto px-6 py-6"
      >
        <div className="space-y-6 text-gray-300 text-sm leading-relaxed">
          <section>
            <h2 className="text-xl text-white mb-4 font-semibold">Пользовательское соглашение</h2>
            <h3 className="text-lg text-white mb-3">Правила посещения и участия в мероприятиях King House</h3>
            <p className="mb-3">
              Настоящие Правила разработаны в целях поддержания порядка, соблюдения безопасности и норм поведения Участников Клуба. 
              Соблюдение этих правил позволит нам сделать Ваше пребывание в Клубе максимально комфортным и приятным.
            </p>
            <p className="mb-3">
              Данные Правила обязательны для исполнения Участником и любыми третьими лицами, находящимися на территории Клуба. 
              Правила не являются исчерпывающими, администрация Клуба вправе их изменять и дополнять по своему усмотрению 
              путем размещения новой редакции Правил в мини-приложении.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">Термины и определения</h2>
            <p className="mb-3">
              В настоящих Правилах нижеприведённые термины используются в следующем значении:
            </p>
            <div className="space-y-3 pl-4">
              <p className="mb-2">
                <span className="text-white font-semibold">1. Клуб (King House)</span> – организация (или индивидуальный предприниматель), 
                выступающая в качестве Администрации, которая организует и проводит Мероприятия.
              </p>
              <p className="mb-2">
                <span className="text-white font-semibold">2. Администрация</span> – уполномоченные представители Клуба, осуществляющие 
                организацию, проведение Мероприятий, контроль за соблюдением настоящих Правил и взаимодействие с Участниками.
              </p>
              <p className="mb-2">
                <span className="text-white font-semibold">3. Мероприятие</span> – запланированное и организованное Клубом событие в 
                формате турнира по карточной игре покер, носящее исключительно развлекательный характер. Мероприятие не является 
                азартной игрой, пари или лотереей и не содержит признаков азартной деятельности в смысле статьи 4 Федерального 
                Закона от 29.12.2006 N 244-ФЗ «О государственном регулировании деятельности по организации и проведению азартных игр…», 
                так как не предполагает внесения ставок, не основано на риске и не связано с выплатой выигрыша или иной имущественной выгодой.
              </p>
              <p className="mb-2">
                <span className="text-white font-semibold">4. Участник</span> – полностью дееспособное физическое лицо, достигшее 
                возраста 18 лет, принявшее условия настоящих Правил в полном объеме и допущенное Администрацией к участию в Мероприятии.
              </p>
              <p className="mb-2">
                <span className="text-white font-semibold">5. Организационный взнос</span> – денежные средства, вносимые Участником 
                Клубу в качестве платы за предоставление комплекса Услуг. Размер взноса является фиксированным в размере 1300 
                (одной тысячи трехсот) рублей. Организационный взнос не является ставкой, банком и не формирует призовой фонд.
              </p>
              <p className="mb-2">
                <span className="text-white font-semibold">6. Игровые фишки</span> – специальные предметы (жетоны), предоставляемые 
                Участнику Администрацией во временное пользование для определения спортивного результата и хода игры в рамках Мероприятия. 
                Фишки являются игровой условностью, не имеют номинальной стоимости, не являются денежным суррогатом, не подлежат 
                покупке, продаже, обмену на денежные средства, товары или услуги как до, так и после Мероприятия.
              </p>
              <p className="mb-2">
                <span className="text-white font-semibold">7. Услуги Клуба</span> – комплекс услуг, предоставляемых Клубом Участнику 
                за организационный взнос, включая, но не ограничиваясь: организацию и проведение Мероприятия, предоставление в аренду 
                игрового оборудования (стол, карты, фишки), обеспечение работы персонала и поддержание условий для проведения досуга.
              </p>
              <p className="mb-2">
                <span className="text-white font-semibold">8. Правила</span> – настоящий документ, регламентирующий порядок участия 
                в Мероприятиях, права и обязанности Сторон, а также иные условия взаимодействия между Клубом и Участником.
              </p>
              <p className="mb-2">
                <span className="text-white font-semibold">9. Мини-приложение</span> – программный интерфейс (чат-бот, приложение), 
                через который осуществляется информирование о Мероприятиях, запись на участие и ознакомление с настоящими Правилами. 
                Регистрация участников осуществляется посредством указания произвольного псевдонима (никнейма), не позволяющего прямо 
                или косвенно идентифицировать физическое лицо и не относящегося к персональным данным в смысле Федерального закона 
                от 27.07.2006 N 152-ФЗ "О персональных данных".
              </p>
              <p className="mb-2">
                <span className="text-white font-semibold">10. Акцепт (принятие Правил)</span> – полное согласие Участника со всеми 
                положениями настоящих Правил, выраженное путем совершения конклюдентных действий (проставления отметки в 
                соответствующем поле интерфейса Мини-приложения).
              </p>
            </div>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">1. Общие положения</h2>
            <p className="mb-3">
              1.1. Настоящие Правила посещения и участия в мероприятиях (далее – «Правила») регулируют порядок взаимодействия 
              между Администрацией Клуба «King House» (далее – «Клуб», «Администрация») и физическим лицом (посетителем), 
              выразившим согласие с настоящими Правилами и принявшим участие в мероприятии (далее – «Участник»).
            </p>
            <p className="mb-3">
              1.2. Клуб «King House» организует и проводит досуговые, развлекательные и спортивные мероприятия в формате 
              турниров по карточной не азартной игре покер (не на деньги).
            </p>
            <p className="mb-3">
              1.3. Ключевой принцип: Мероприятия Клуба носят исключительно развлекательный и спортивный характер. Любые формы 
              азартных игр на деньги, проведение игр в целях извлечения прибыли участниками, а также формирование призовых 
              фондов (банков) и выплата денежного выигрыша (приза) строго запрещены на территории Клуба и в рамках его мероприятий. 
              Деятельность Клуба осуществляется в строгом соответствии с Федеральным законом от 29.12.2006 N 244-ФЗ 
              «О государственном регулировании деятельности по организации и проведению азартных игр…», исключающим проведение 
              азартных игр вне игорных зон.
            </p>
            <p className="mb-3">
              1.4. Фактом согласия и принятия настоящих Правил считается совершение Участником последовательных конклюдентных 
              действий: 1) Проставления отметки о согласии в специальном поле интерфейса Мини-приложения 2) Последующего внесения 
              организационного взноса.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">2. Характер мероприятий и порядок участия</h2>
            <p className="mb-3">
              2.1. Мероприятия Клуба являются турнирами по спортивному покеру не на деньги. Единственным объектом игры являются 
              игровые фишки, не имеющие денежной стоимости и не подлежащие обмену на денежные средства, товары или услуги. 
              Фишки являются исключительной игровой условностью и инструментом для определения спортивного результата в рамках 
              конкретного турнира.
            </p>
            <p className="mb-3">
              2.2. Для участия в турнире Участник обязан внести целевой организационный взнос в размере 1300 (одна тысяча триста) рублей.
            </p>
            <p className="mb-3">
              2.3. Организационный взнос является оплатой Клубу за оказание комплекса услуг, включая, но не ограничиваясь:
            </p>
            <ul className="list-disc pl-6 mb-3 space-y-1">
              <li>Организацию и проведение мероприятия;</li>
              <li>Предоставление во временное пользование (аренду) игрового оборудования (стол, карты, фишки и пр.);</li>
              <li>Обеспечение комфортных условий для проведения досуга (услуги персонала, обслуживание помещения).</li>
            </ul>
            <p className="mb-3">
              2.4. Внесение организационного взноса и участие в турнире не образуют правовых оснований для возникновения 
              обязательств азартной игры, пари или лотереи, как они определены в ст. 1062 и 1063 Гражданского кодекса РФ, 
              а также в вышеуказанном Федеральном законе N 244-ФЗ.
            </p>
            <p className="mb-3">
              2.5. В отдельных случаях Клуб может вести условную рейтинговую систему, начисляя Участникам баллы за регулярное 
              участие и иные нематериальные показатели. Такая система:
            </p>
            <ul className="list-disc pl-6 mb-3 space-y-1">
              <li>Не влияет на качество или объём оказываемых услуг;</li>
              <li>Не является конкурсной, соревновательной или азартной;</li>
              <li>Не влечёт за собой обязательств со стороны Исполнителя.</li>
            </ul>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">3. Условия аренды оборудования и окончание участия</h2>
            <p className="mb-3">
              3.1. Внесение организационного взноса предоставляет Участнику право на получение игровых фишек для участия в 
              турнире и пользование игровым оборудованием на время проведения мероприятия.
            </p>
            <p className="mb-3">
              3.2. Аренда оборудования считается оконченной, а участие Участника в турнире прекращённым в момент наступления 
              одного из следующих событий:
            </p>
            <ul className="list-disc pl-6 mb-3 space-y-1">
              <li>Участник полностью израсходовал (потерял в процессе игры) все выданные ему игровые фишки («выбыл из турнира»);</li>
              <li>Участник стал победителем турнира (единственным обладателем всех игровых фишек в рамках данного турнира);</li>
              <li>Участник добровольно отказался от дальнейшего участия;</li>
              <li>Администрация приняла решение о прекращении аренды в одностороннем порядке в соответствии с п. 3.3 настоящих Правил.</li>
            </ul>
            <p className="mb-3">
              3.3. Администрация оставляет за собой право в одностороннем внесудебном порядке прекратить предоставление услуг 
              и потребовать покинуть помещение Клуба любого Участника, который нарушает настоящие Правила, общественный порядок, 
              нормы морали и этики, либо своими действиями создает угрозу безопасности и комфорту других Участников. В указанном 
              случае организационный взнос возврату не подлежит.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">4. Правила поведения</h2>
            <p className="mb-3">
              4.1. Участники обязаны соблюдать правила общественного порядка, нормы законодательства РФ, а также руководствоваться 
              принципами взаимного уважения и добросовестного поведения.
            </p>
            <p className="mb-3">
              4.2. Участник вправе проводить время так, как ему комфортно, при условии, что его действия прямо не нарушают права 
              и законные интересы других Участников, Администрации и третьих лиц.
            </p>
            <p className="mb-3">
              4.3. Запрещается любое поведение, которое может быть расценено как агрессивное, оскорбительное, неэтичное, 
              мошенническое, либо направленное на срыв мероприятия.
            </p>
          </section>

          <section>
            <h2 className="text-lg text-white mb-3">5. Заключительные положения</h2>
            <p className="mb-3">
              5.1. Настоящие Правила являются официальным документом и обязательны для ознакомления и согласия перед участием 
              в любом мероприятии Клуба.
            </p>
            <p className="mb-3">
              5.2. Администрация не несет ответственности за личные вещи Участников.
            </p>
            <p className="mb-3">
              5.3. Все спорные ситуации, возникающие в ходе применения настоящих Правил, подлежат разрешению путем переговоров 
              между Участником и Администрацией. В случае невозможности разрешения спора мирным путем, все претензии рассматриваются 
              в соответствии с действующим законодательством Российской Федерации по месту нахождения Клуба.
            </p>
            <p className="mb-3">
              5.4. Администрация оставляет за собой право вносить изменения в настоящие Правила с обязательным предварительным 
              уведомлением Участников путем публикации новой редакции Правил в мини-приложении.
            </p>
          </section>

          <div className="h-4"></div>
        </div>
      </div>

      {/* Footer with Accept Button */}
      <div className="px-6 py-4 border-t border-gray-800 bg-black">
        <button
          onClick={onAccept}
          disabled={!isScrolledToBottom}
          className={`w-full py-3.5 rounded-xl transition-all flex items-center justify-center ${
            isScrolledToBottom
              ? 'bg-gradient-to-b from-red-600 to-red-800 hover:from-red-700 hover:to-red-900 text-white cursor-pointer'
              : 'bg-gray-800 text-gray-500 cursor-not-allowed'
          }`}
        >
          Принять
        </button>
      </div>
    </div>
  );
}


